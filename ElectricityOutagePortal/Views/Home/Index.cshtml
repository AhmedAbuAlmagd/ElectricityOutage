@model ElectricityOutagePortal.ViewModels.SearchViewModel
@{
    ViewData["Title"] = "Cutting Portal - Search";
}

<div class="container-fluid">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12 text-center">
            <div class="portal-header">
                <h2 class="portal-title">Cutting Portal</h2>
            </div>
        </div>
    </div>

    <!-- Navigation Buttons -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="nav-buttons">
                <button type="button" class="btn btn-primary active" onclick="showSearchTab()">
                    <i class="fas fa-search"></i> Search
                </button>
                <button type="button" class="btn btn-outline-secondary" onclick="showIgnoredTab()">
                    <i class="fas fa-eye-slash"></i> Ignored Outages
                </button>
                <button type="button" class="btn btn-outline-info" onclick="location.href='@Url.Action("NetworkHierarchy")'">
                    <i class="fas fa-plus"></i> Add
                </button>
            </div>
        </div>
    </div>

    <!-- Advanced Search Section -->
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0">Advanced Search</h5>
        </div>
        <div class="card-body">
            <form asp-action="Index" method="post">
                <div class="row">
                    <!-- Source of Cutting down -->
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Source of Cutting down</label>
                        <select asp-for="SourceCutting" class="form-select">
                            <option value="">Please Select</option>
                            @if (Model?.Sources != null)
                            {
                                @foreach (var source in Model.Sources)
                                {
                                    <option value="@source.Id" selected="@(Model.SourceCutting == source.Id)">@source.Name</option>
                                }
                            }
                        </select>
                    </div>

                    <!-- Problem type of cutting down -->
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Problem type of cutting down</label>
                        <select asp-for="ProblemTypeKey" class="form-select">
                            <option value="">Please Select</option>
                            @if (Model?.ProblemTypes != null)
                            {
                                @foreach (var problemType in Model.ProblemTypes)
                                {
                                    <option value="@problemType.Problem_Type_Key" selected="@(Model.ProblemTypeKey == problemType.Problem_Type_Key)">@problemType.Problem_Type_Name</option>
                                }
                            }
                        </select>
                    </div>
                </div>

                <div class="row">
                    <!-- Status -->
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Status</label>
                        <select asp-for="Status" class="form-select">
                            <option value="">Please Select</option>
                            @if (Model?.Statuses != null)
                            {
                                @foreach (var status in Model.Statuses)
                                {
                                    <option value="@status.Id" selected="@(Model.Status == status.Id)">@status.Name</option>
                                }
                            }
                        </select>
                    </div>

                    <!-- Search Criteria -->
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Search Criteria</label>
                        <select asp-for="SearchCriteriaKey" class="form-select">
                            <option value="">Please Select</option>
                            @if (Model?.SearchCriterias != null)
                            {
                                @foreach (var criteria in Model.SearchCriterias)
                                {
                                    <option value="@criteria.Id" selected="@(Model.SearchCriteriaKey == criteria.Id)">@criteria.Name</option>
                                }
                            }
                        </select>
                    </div>
                </div>

                <div class="row">
                    <!-- Search Value -->
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Search Value</label>
                        <input asp-for="SearchValue" class="form-control" placeholder="Search Value" />
                    </div>

                    <!-- Search Button -->
                    <div class="col-md-6 mb-3 d-flex align-items-end">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-search"></i> Search
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Search Results Table -->
    @if (Model?.Results != null && Model.Results.Any())
    {
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <span>Search Results</span>
                <input type="text" class="form-control search-box" placeholder="Search..." style="width: 200px;">
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-striped table-hover mb-0">
                        <thead class="table-dark">
                            <tr>
                                <th><input type="checkbox" class="form-check-input" id="selectAll"></th>
                                <th>Cutting_Down_Key</th>
                                <th>Cutting_Down_Incident_ID</th>
                                <th>Channel_Key</th>
                                <th>IsPlanned</th>
                                <th>IsGlobal</th>
                                <th>PlannedStartDTS</th>
                                <th>PlannedEndDTS</th>
                                <th>CreateSystemUserID</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model.Results)
                            {
                                <tr>
                                    <td><input type="checkbox" class="form-check-input row-checkbox"></td>
                                    <td>@item.Cutting_Down_Key</td>
                                    <td>@item.Cutting_Down_Incident_ID</td>
                                    <td>@item.Channel_Key</td>
                                    <td>@(item.IsPlanned == true ? "Yes" : "No")</td>
                                    <td>@(item.IsGlobal == true ? "Yes" : "No")</td>
                                    <td>@item.PlannedStartDTS?.ToString("dd/MM/yyyy")</td>
                                    <td>@item.PlannedEndDTS?.ToString("dd/MM/yyyy")</td>
                                    <td>@item.CreateSystemUserID</td>
                                    <td>
                                        <button type="button" class="btn btn-primary btn-sm">View</button>
                                        <button type="button" class="btn btn-success btn-sm">Close</button>
                                        <button type="button" class="btn btn-danger btn-sm">Close All</button>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Pagination -->
        <div class="row mt-3">
            <div class="col-md-6">
                <nav aria-label="Page navigation">
                    <ul class="pagination">
                        @if (Model.PagedResults?.HasPreviousPage == true)
                        {
                            <li class="page-item">
                                <a class="page-link" href="@Url.Action("Index", new { pageNumber = 1, pageSize = Model.PageSize })">First</a>
                            </li>
                            <li class="page-item">
                                <a class="page-link" href="@Url.Action("Index", new { pageNumber = Model.PageNumber - 1, pageSize = Model.PageSize })">Previous</a>
                            </li>
                        }

                        @if (Model.PagedResults != null)
                        {
                            @for (int i = Math.Max(1, Model.PageNumber - 2); i <= Math.Min(Model.PagedResults.TotalPages, Model.PageNumber + 2); i++)
                            {
                                <li class="page-item @(i == Model.PageNumber ? "active" : "")">
                                    <a class="page-link" href="@Url.Action("Index", new { pageNumber = i, pageSize = Model.PageSize })">@i</a>
                                </li>
                            }
                        }

                        @if (Model.PagedResults?.HasNextPage == true)
                        {
                            <li class="page-item">
                                <a class="page-link" href="@Url.Action("Index", new { pageNumber = Model.PageNumber + 1, pageSize = Model.PageSize })">Next</a>
                            </li>
                            <li class="page-item">
                                <a class="page-link" href="@Url.Action("Index", new { pageNumber = Model.PagedResults.TotalPages, pageSize = Model.PageSize })">Last</a>
                            </li>
                        }
                    </ul>
                </nav>
            </div>
            <div class="col-md-6 text-end">
                <div class="pagination-info">
                    <select class="form-select d-inline-block w-auto me-2" onchange="changePageSize(this.value)">
                        <option value="20" selected="@(Model.PageSize == 20)">20</option>
                        <option value="50" selected="@(Model.PageSize == 50)">50</option>
                        <option value="100" selected="@(Model.PageSize == 100)">100</option>
                    </select>
                    items per page
                    <br>
                    <small class="text-muted">Total: @Model.TotalCount</small>
                </div>
            </div>
        </div>
    }
    else if (ViewContext.HttpContext.Request.Method == "POST")
    {
        <div class="alert alert-info">
            <i class="fas fa-info-circle"></i> No results found for your search criteria.
        </div>
    }
</div>

<style>
    .portal-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px;
        border-radius: 10px;
        margin-bottom: 20px;
    }

    .portal-title {
        margin: 0;
        font-weight: 600;
    }

    .nav-buttons {
        display: flex;
        gap: 10px;
        justify-content: flex-start;
    }

    .nav-buttons .btn {
        border-radius: 20px;
        padding: 8px 20px;
        font-weight: 500;
    }

    .export-buttons {
        display: flex;
        gap: 10px;
    }

    .search-box {
        border-radius: 20px;
    }

    .table th {
        background-color: #495057;
        color: white;
        border: none;
        font-weight: 500;
        padding: 12px 8px;
        font-size: 14px;
    }

    .table td {
        padding: 10px 8px;
        vertical-align: middle;
        font-size: 14px;
    }

    .table-hover tbody tr:hover {
        background-color: #f8f9fa;
    }

    .btn-sm {
        padding: 4px 8px;
        font-size: 12px;
        margin-right: 2px;
    }

    .pagination-info {
        display: flex;
        align-items: center;
        justify-content: flex-end;
        gap: 10px;
    }

    .card {
        border: none;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .card-header {
        background-color: #f8f9fa;
        border-bottom: 1px solid #dee2e6;
        font-weight: 600;
    }
</style>

<script>
    function showSearchTab() {
        // Implementation for showing search tab
        location.href = '@Url.Action("Index")';
    }

    function showIgnoredTab() {
        // Implementation for showing ignored outages tab
        location.href = '@Url.Action("IgnoredOutages")';
    }

    function changePageSize(pageSize) {
        var url = new URL(window.location);
        url.searchParams.set('pageSize', pageSize);
        url.searchParams.set('pageNumber', '1');
        window.location = url;
    }

    // Select all checkbox functionality
    document.getElementById('selectAll')?.addEventListener('change', function() {
        var checkboxes = document.querySelectorAll('.row-checkbox');
        checkboxes.forEach(function(checkbox) {
            checkbox.checked = this.checked;
        }, this);
    });
</script>
